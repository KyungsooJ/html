<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ex05.html</title>
</head>
<body>

    <h1>파일 첨부 여러개</h1>
    <hr>

    <form>
        <p><input type="text" name="title" placeholder="제목"></p>
        <p><textarea name="content" placeholder="내용"></textarea></p>
        <div id="inputFiles">
            <p>
            <input type="file" name="uploadFile[0]">
            <input class="deleteBtn" type="button" value="항목 제거">
        </p>
        </div>
        <p>
            <input id ="addBtn" type= "button" value="파일 추가">
            <input type= "submit">
        </p>
    </form>

    <script>
        const addBtn = document.getElementById('addBtn')
        const inputFiles = document.getElementById('inputFiles')

        const clickHandler = function(event) {
            const size = document.querySelectorAll('input[type="file"]').length

            // 1) p태그를 생성하고 input[type="file"]과 삭제버튼을 넣어준다
            const p = document.createElement('p')
            const input = document.createElement('input')
            input.type = 'file'
            input.name = `uploadFile[${size}]`
            const deleteBtn = document.createElement('input')
            deleteBtn.type = 'button'
            deleteBtn.classList.add('deleteBtn')
            deleteBtn.value = '항목 제거'
            deleteBtn.onclick = deleteHandler

            p.appendChild(input)
            p.innerHTML += ' '
            p.appendChild(deleteBtn)

            // 2) inputFiles에 생성한 p태그를 추가한다
            inputFiles.appendChild(p)
        }

        const deleteHandler = function(event) {
            // 클릭한 버튼의 부모요소(p)를 찾아서 저장하고
            const p = event.target.parentNode

            // inputFiles에서 p를 제거한다
            inputFiles.removeChild(p)
        }
        // form 태그는 사용자 입력을 서버에 전달하는 특수한 태그이다
        // querySelector나 getElementById 없이 전체 문서의 i번째 form을 불러올 수 있다
        const form = document.forms[0]

        // form 내부의 input, select, textarea 등을 묶어서 제출하는 작업을 submit이라고 한다
        // submit시에 이벤트를 별도로 지정할 수 있다

        form.onsubmit = function(event) {
            // 이번에트의 기본 작동을 막는다 (제출하지 않음)
            event.preventDefault()

            const flag = confirm('정말 제출하시겠습니까?')

            if(flag) {  // 예를 누르면, 자바스크립트 함수로 제출시킨다
                event.target.submit()
            }
            else {      // 아니오를 누르면, 팝업창을 띄우고 함수를 종료한다
                alert('제출이 취소되었습니다')
            }
        }

        const firstDeleteBtn =document.querySelector('input.deleteBtn')
        firstDeleteBtn.onclick = deleteHandler
        addBtn.onclick = clickHandler
    </script>
</body>
</html>